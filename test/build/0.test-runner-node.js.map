{"version":3,"sources":["/mnt/data/ForceUser/Projects/template-parser/src/scope.js","/mnt/data/ForceUser/Projects/template-parser/test/unit-tests/index.js"],"names":["isInvalid","value","Scope","constructor","stack","new","scope","get","chain","getter","callArgs","chainIdx","error","i","length","key","context","undefined","apply","set","setter","val","runTest","test","t","moo","a","b","p","foo","bar","baz","scope2","ll","equals","x","v","end"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;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","file":"0.test-runner-node.js","sourcesContent":["const isInvalid = (value) => value == null || (typeof value !== \"object\" && typeof value !== \"function\");\n\nexport default class Scope {\n\tconstructor (stack) {\n\t\tthis.stack = [...stack];\n\t}\n\tnew (scope) {\n\t\treturn new Scope([...this.stack, scope || {}]);\n\t}\n\tget (chain, getter, callArgs) {\n\t\tlet chainIdx = 0;\n\t\tlet value;\n\t\ttry {\n\t\t\tvalue = getter();\n\t\t\tchainIdx = 1;\n\t\t}\n\t\tcatch (error) {/* read variable from local scope if it is declared */}\n\n\t\tif (chainIdx === 0) {\n\t\t\tlet i = this.stack.length - 1;\n\t\t\tconst key = chain[0];\n\t\t\twhile (i >= 0) {\n\t\t\t\tif (key in this.stack[i]) {\n\t\t\t\t\tvalue = this.stack[i][key];\n\t\t\t\t\tchainIdx = 1;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\ti--;\n\t\t\t}\n\t\t}\n\t\tlet context;\n\t\twhile (chainIdx < chain.length) {\n\t\t\tif (isInvalid(value)) {\n\t\t\t\treturn undefined;\n\t\t\t}\n\t\t\tconst key = chain[chainIdx];\n\t\t\tcontext = value;\n\t\t\tvalue = value[key];\n\t\t\tchainIdx++;\n\t\t}\n\n\t\tif (chainIdx === chain.length && callArgs && typeof value === \"function\") {\n\t\t\treturn value.apply(context, callArgs);\n\t\t}\n\t\treturn value;\n\t}\n\tset (chain, getter, setter, val) {\n\t\tlet chainIdx = 0;\n\t\tlet value;\n\t\ttry {\n\t\t\tvalue = getter();\n\t\t\tif (chain.length > 1) {\n\t\t\t\tif (isInvalid(value)) {\n\t\t\t\t\tvalue = {};\n\t\t\t\t\tsetter(value);\n\t\t\t\t}\n\t\t\t}\n\t\t\telse {\n\t\t\t\treturn setter(val);\n\t\t\t}\n\t\t\tchainIdx = 1;\n\t\t}\n\t\tcatch (error) {/* read variable from local scope if it is declared */}\n\t\tlet context = value;\n\t\tif (chainIdx === 0) {\n\t\t\tlet i = this.stack.length - 1;\n\t\t\tconst key = chain[0];\n\t\t\twhile (i >= 0) {\n\t\t\t\tif (key in this.stack[i] || i === 0) {\n\t\t\t\t\tcontext = this.stack[i];\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\ti--;\n\t\t\t}\n\t\t}\n\n\t\twhile (chainIdx < chain.length) {\n\t\t\tconst key = chain[chainIdx];\n\t\t\tvalue = context[key];\n\t\t\tif (chainIdx === chain.length - 1) {\n\t\t\t\treturn context[key] = val;\n\t\t\t}\n\t\t\tif (isInvalid(value)) {\n\t\t\t\tvalue = {};\n\t\t\t\tcontext[key] = value;\n\t\t\t}\n\t\t\tcontext = value;\n\t\t\tchainIdx++;\n\t\t}\n\t}\n}\n","import sinon from \"sinon\";\nimport Scope from \"src/scope.js\";\n\nexport default function runTest (test) {\n\ttest(\"Example test\", t => {\n\t\tconst moo = {a: {b: 5}};\n\t\tlet p;\n\n\t\tconst scope = new Scope([{\n\t\t\tfoo: {\n\t\t\t\tbar: {\n\t\t\t\t\tbaz: () => 11,\n\t\t\t\t},\n\t\t\t},\n\t\t}]);\n\t\tconst scope2 = scope.new({\n\t\t\tll: 111,\n\t\t});\n\n\t\tt.equals(scope.get([\"moo\", \"a\", \"b\"], () => moo, []), 5);\n\t\tt.equals(scope.get([\"foo\", \"bar\", \"baz\"], () => foo, []), 11);\n\t\tt.equals(scope.set([\"a\", \"b\", \"c\"], () => a, val => a = val, 15), 15);\n\t\tt.equals(scope.get([\"a\", \"b\", \"c\"], () => a), 15);\n\t\tt.equals(scope.set([\"x\"], () => x, v => x = v, \"x-val\"), \"x-val\");\n\t\tt.equals(scope.set([\"p\", \"t\"], () => p, v => p = v, \"test\"), \"test\");\n\t\tt.equals(p.t, \"test\");\n\t\tt.equals(scope2.get([\"ll\"], () => ll), 111);\n\t\tt.equals(scope2.get([\"foo\", \"bar\", \"baz\"], () => foo, []), 11);\n\t\tt.end();\n\t});\n}\n"],"sourceRoot":""}