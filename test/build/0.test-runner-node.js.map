{"version":3,"sources":["/home/forceuser/Projects/template-parser/src/scope.js","/home/forceuser/Projects/template-parser/test/unit-tests/index.js"],"names":["isInvalid","value","spitPath","path","split","Scope","constructor","stack","get","bind","set","call","new","scope","chain","callArgs","getter","chainIdx","error","i","length","key","context","undefined","apply","val","setter","runTest","test","t","moo","a","b","p","foo","bar","baz","scope2","ll","equals","x","v","end"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;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","file":"0.test-runner-node.js","sourcesContent":["const isInvalid = (value) => value == null || (typeof value !== \"object\" && typeof value !== \"function\");\n\nconst spitPath = (path) => path.split(\".\");\n\nexport default class Scope {\n\tconstructor (stack) {\n\t\tthis.stack = [...stack];\n\t\tthis.get = this.get.bind(this);\n\t\tthis.set = this.set.bind(this);\n\t\tthis.call = this.call.bind(this);\n\t\tthis.new = this.new.bind(this);\n\t}\n\tnew (scope) {\n\t\treturn new Scope([...this.stack, scope || {}]);\n\t}\n\tcall (chain, callArgs) {\n\t\treturn this.get(chain, null, callArgs);\n\t}\n\tget (chain, getter, callArgs) {\n\t\tif (typeof chain === \"string\") {\n\t\t\tchain = spitPath(chain);\n\t\t}\n\n\t\tlet chainIdx = 0;\n\t\tlet value;\n\t\tif (typeof getter === \"function\") {\n\t\t\ttry {\n\t\t\t\tvalue = getter();\n\t\t\t\tchainIdx = 1;\n\t\t\t}\n\t\t\tcatch (error) {/* read variable from local scope if it is declared */}\n\t\t}\n\n\t\tif (chainIdx === 0) {\n\t\t\tlet i = this.stack.length - 1;\n\t\t\tconst key = chain[0];\n\t\t\twhile (i >= 0) {\n\t\t\t\tif (key in this.stack[i]) {\n\t\t\t\t\tvalue = this.stack[i][key];\n\t\t\t\t\tchainIdx = 1;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\ti--;\n\t\t\t}\n\t\t}\n\t\tlet context;\n\t\twhile (chainIdx < chain.length) {\n\t\t\tif (isInvalid(value)) {\n\t\t\t\treturn undefined;\n\t\t\t}\n\t\t\tconst key = chain[chainIdx];\n\t\t\tcontext = value;\n\t\t\tvalue = value[key];\n\t\t\tchainIdx++;\n\t\t}\n\n\t\tif (chainIdx === chain.length && callArgs && typeof value === \"function\") {\n\t\t\treturn value.apply(context, callArgs);\n\t\t}\n\t\treturn value;\n\t}\n\tset (chain, val, getter, setter) {\n\t\tif (typeof chain === \"string\") {\n\t\t\tchain = spitPath(chain);\n\t\t}\n\t\tlet chainIdx = 0;\n\t\tlet value;\n\t\tif (typeof getter === \"function\" && typeof setter === \"function\") {\n\t\t\ttry {\n\t\t\t\tvalue = getter();\n\t\t\t\tif (chain.length > 1) {\n\t\t\t\t\tif (isInvalid(value)) {\n\t\t\t\t\t\tvalue = {};\n\t\t\t\t\t\tsetter(value);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\treturn setter(val);\n\t\t\t\t}\n\t\t\t\tchainIdx = 1;\n\t\t\t}\n\t\t\tcatch (error) {/* read variable from local scope if it is declared */}\n\t\t}\n\n\t\tlet context = value;\n\t\tif (chainIdx === 0) {\n\t\t\tlet i = this.stack.length - 1;\n\t\t\tconst key = chain[0];\n\t\t\twhile (i >= 0) {\n\t\t\t\tif (key in this.stack[i] || i === 0) {\n\t\t\t\t\tcontext = this.stack[i];\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\ti--;\n\t\t\t}\n\t\t}\n\n\t\twhile (chainIdx < chain.length) {\n\t\t\tconst key = chain[chainIdx];\n\t\t\tvalue = context[key];\n\t\t\tif (chainIdx === chain.length - 1) {\n\t\t\t\treturn context[key] = val;\n\t\t\t}\n\t\t\tif (isInvalid(value)) {\n\t\t\t\tvalue = {};\n\t\t\t\tcontext[key] = value;\n\t\t\t}\n\t\t\tcontext = value;\n\t\t\tchainIdx++;\n\t\t}\n\t}\n}\n","import sinon from \"sinon\";\nimport Scope from \"src/scope.js\";\n\nexport default function runTest (test) {\n\ttest(\"Example test\", t => {\n\t\tconst moo = {a: {b: 5}};\n\t\tlet p;\n\n\t\tconst scope = new Scope([{\n\t\t\tfoo: {\n\t\t\t\tbar: {\n\t\t\t\t\tbaz: () => 11,\n\t\t\t\t},\n\t\t\t},\n\t\t}]);\n\t\tconst scope2 = scope.new({\n\t\t\tll: 111,\n\t\t});\n\n\t\tt.equals(scope.get([\"moo\", \"a\", \"b\"], () => moo, []), 5);\n\t\tt.equals(scope.get([\"foo\", \"bar\", \"baz\"], () => foo, []), 11);\n\t\tt.equals(scope.set([\"a\", \"b\", \"c\"], 15, () => a, val => a = val), 15);\n\t\tt.equals(scope.get([\"a\", \"b\", \"c\"], () => a), 15);\n\t\tt.equals(scope.set([\"x\"], \"x-val\", () => x, v => x = v), \"x-val\");\n\t\tt.equals(scope.set([\"p\", \"t\"], \"test\", () => p, v => p = v), \"test\");\n\t\tt.equals(p.t, \"test\");\n\t\tt.equals(scope2.get([\"ll\"], () => ll), 111);\n\t\tt.equals(scope2.get([\"foo\", \"bar\", \"baz\"], () => foo, []), 11);\n\t\tt.end();\n\t});\n}\n"],"sourceRoot":""}